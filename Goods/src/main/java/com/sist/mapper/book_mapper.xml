<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.seoul-mapper">
<select id="bookListData" resultType="BookVO" parameterType="hashmap">
    SELECT bno,btag,bgenre,cover,btitle,writer,price,sale_price,dis_rate,publisher,intro,intro_img,pages,isbn13,isbn10,bdate,num
    FROM (SELECT bno,btag,bgenre,cover,btitle,writer,price,sale_price,dis_rate,publisher,intro,intro_img,pages,isbn13,isbn10,bdate,rownum as num
    FROM (SELECT bno,btag,bgenre,cover,btitle,writer,price,sale_price,dis_rate,publisher,intro,intro_img,pages,isbn13,isbn10,bdate
    FROM book WHERE ( btitle LIKE '%'||#{search}||'%' OR
			                writer LIKE '%'||#{search}||'%' OR
			                btag LIKE '%'||#{search}||'%' OR
			                bgenre LIKE '%'||#{search}||'%' OR
			                publisher LIKE '%'||#{search}||'%') AND
    bgenre LIKE '%'||#{genre}||'%'
    ORDER BY bno ASC))
    WHERE num BETWEEN #{start} AND #{end}
  </select>

  <select id="bookTotalPage" resultType="int" parameterType="String">
    SELECT CEIL(COUNT(*)/20.0) FROM book WHERE bgenre LIKE '%'||#{genre}||'%'
  </select>
  
  <select id="bookListCount" resultType="int" parameterType="hashmap">
		SELECT COUNT(*) FROM book WHERE bgenre LIKE '%'||#{genre}||'%'
  </select>
  
	<select id="bookDetailData" resultType="BookVO" parameterType="int">
		SELECT bno,btag,bgenre,cover,btitle,writer,price,sale_price,dis_rate,publisher,intro,intro_img,pages,isbn13,isbn10,TO_CHAR(bdate,'YYYY-MM-DD') as dbday
		FROM book
		WHERE bno=#{bno}
	</select>
	
	<select id="bookNewData" resultType="BookVO" parameterType="hashmap">
    SELECT bno,btag,bgenre,cover,btitle,writer,price,sale_price,dis_rate,publisher,intro,intro_img,pages,isbn13,isbn10,bdate,num
    FROM (SELECT bno,btag,bgenre,cover,btitle,writer,price,sale_price,dis_rate,publisher,intro,intro_img,pages,isbn13,isbn10,bdate,rownum as num
    FROM (SELECT bno,btag,bgenre,cover,btitle,writer,price,sale_price,dis_rate,publisher,intro,intro_img,pages,isbn13,isbn10,bdate
    FROM book 
    WHERE bdate IS NOT NULL 
    AND intro IS NOT NULL
    AND cover IS NOT NULL
    AND intro_img IS NOT NULL
    ORDER BY bdate DESC))
    WHERE num BETWEEN #{start} AND #{end}
  </select>
  
  <select id="bookFindListData" resultType="BookVO" parameterType="hashmap">
    SELECT bno,btag,bgenre,cover,btitle,writer,sale_price,dis_rate,publisher,bdate,num
    FROM (SELECT bno,btag,bgenre,cover,btitle,writer,sale_price,dis_rate,publisher,bdate,rownum as num 
    FROM (SELECT /*+ INDEX_ASC(book book_bno_pk)*/SELECT bno,btag,bgenre,cover,btitle,writer,sale_price,dis_rate,publisher,bdate
    FROM book WHERE ( btitle LIKE '%'||#{search}||'%' OR
			                writer LIKE '%'||#{search}||'%' OR
			                btag LIKE '%'||#{search}||'%' OR
			                bgenre LIKE '%'||#{search}||'%' OR
			                publisher LIKE '%'||#{search}||'%')))
    WHERE num BETWEEN #{start} AND #{end}
  </select>
  
  <select id="bookFindTotalPage" resultType="int" parameterType="hashmap">
    SELECT CEIL(COUNT(*) / 20.0) 
    FROM book
    WHERE ( btitle LIKE '%'||#{search}||'%' OR
		        writer LIKE '%'||#{search}||'%' OR
		        btag LIKE '%'||#{search}||'%' OR
		        bgenre LIKE '%'||#{search}||'%' OR
		        publisher LIKE '%'||#{search}||'%')
		AND bgenre LIKE '%'||#{genre}||'%'    
</select>
</mapper>